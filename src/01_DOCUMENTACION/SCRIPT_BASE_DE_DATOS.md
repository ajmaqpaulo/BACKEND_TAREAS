
/****** COPIAR Y PEGAR SCRIPT EN BASE DE DATOS SQL SERVER 2019 ******/

USE [BD_GESTION_TAREAS]
GO
/****** Object:  Table [dbo].[AUDITORIA_TAREAS]    Script Date: 18/02/2026 15:11:55 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[AUDITORIA_TAREAS](
	[ID] [bigint] IDENTITY(1,1) NOT NULL,
	[USUARIO_ID] [uniqueidentifier] NULL,
	[USUARIO_NOMBRE] [nvarchar](200) NULL,
	[ROL_CODIGO] [nvarchar](50) NULL,
	[UNIDAD_ID] [uniqueidentifier] NULL,
	[ACCION] [nvarchar](50) NOT NULL,
	[ENTIDAD] [nvarchar](100) NOT NULL,
	[ENTIDAD_ID] [nvarchar](100) NULL,
	[DATOS_ANTERIORES] [nvarchar](max) NULL,
	[DATOS_NUEVOS] [nvarchar](max) NULL,
	[DIRECCION_IP] [nvarchar](45) NULL,
	[AGENTE_USUARIO] [nvarchar](500) NULL,
	[RESULTADO] [nvarchar](20) NOT NULL,
	[DETALLE] [nvarchar](500) NULL,
	[CREADO_EN] [datetime2](7) NOT NULL,
 CONSTRAINT [PK_AUDITORIA_TAREAS] PRIMARY KEY CLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]
GO
/****** Object:  Table [dbo].[ESTADO_TAREA]    Script Date: 18/02/2026 15:11:55 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[ESTADO_TAREA](
	[ID] [uniqueidentifier] NOT NULL,
	[NOMBRE] [nvarchar](100) NOT NULL,
	[COLOR] [nvarchar](7) NOT NULL,
	[ORDEN] [int] NOT NULL,
	[ES_DEFECTO] [bit] NOT NULL,
	[ESTA_ACTIVO] [bit] NOT NULL,
	[CREADO_EN] [datetime2](7) NOT NULL,
	[ACTUALIZADO_EN] [datetime2](7) NOT NULL,
	[ELIMINADO_EN] [datetime2](7) NULL,
	[CREADO_POR] [uniqueidentifier] NULL,
 CONSTRAINT [PK_ESTADO_TAREA] PRIMARY KEY CLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[HISTORIAL_TAREA]    Script Date: 18/02/2026 15:11:55 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[HISTORIAL_TAREA](
	[ID] [bigint] IDENTITY(1,1) NOT NULL,
	[TAREA_ID] [uniqueidentifier] NOT NULL,
	[ACCION] [nvarchar](20) NOT NULL,
	[DATOS_ANTERIORES] [nvarchar](max) NULL,
	[DATOS_NUEVOS] [nvarchar](max) NULL,
	[SOLICITUD_ID] [uniqueidentifier] NULL,
	[REALIZADO_POR] [uniqueidentifier] NOT NULL,
	[CREADO_EN] [datetime2](7) NOT NULL,
 CONSTRAINT [PK_HISTORIAL_TAREA] PRIMARY KEY CLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]
GO
/****** Object:  Table [dbo].[SOLICITUD_APROBACION]    Script Date: 18/02/2026 15:11:55 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[SOLICITUD_APROBACION](
	[ID] [uniqueidentifier] NOT NULL,
	[TAREA_ID] [uniqueidentifier] NULL,
	[TIPO_ACCION] [nvarchar](20) NOT NULL,
	[TITULO] [nvarchar](300) NOT NULL,
	[DESCRIPCION] [nvarchar](max) NULL,
	[ESTADO_ID] [uniqueidentifier] NULL,
	[PRIORIDAD] [nvarchar](10) NOT NULL,
	[UNIDAD_ID] [uniqueidentifier] NOT NULL,
	[SOLICITANTE_ID] [uniqueidentifier] NOT NULL,
	[ESTADO_SOLICITUD] [nvarchar](20) NOT NULL,
	[APROBADO_POR] [uniqueidentifier] NULL,
	[FECHA_RESOLUCION] [datetime2](7) NULL,
	[MOTIVO_RECHAZO] [nvarchar](500) NULL,
	[CREADO_EN] [datetime2](7) NOT NULL,
 CONSTRAINT [PK_SOLICITUD_APROBACION] PRIMARY KEY CLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]
GO
/****** Object:  Table [dbo].[TAREA]    Script Date: 18/02/2026 15:11:55 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[TAREA](
	[ID] [uniqueidentifier] NOT NULL,
	[TITULO] [nvarchar](300) NOT NULL,
	[DESCRIPCION] [nvarchar](max) NULL,
	[ESTADO_ID] [uniqueidentifier] NOT NULL,
	[PRIORIDAD] [nvarchar](10) NOT NULL,
	[UNIDAD_ID] [uniqueidentifier] NOT NULL,
	[CREADO_POR] [uniqueidentifier] NOT NULL,
	[ASIGNADO_A] [uniqueidentifier] NULL,
	[FECHA_CREACION] [datetime2](7) NOT NULL,
	[ACTUALIZADO_EN] [datetime2](7) NOT NULL,
	[ELIMINADO_EN] [datetime2](7) NULL,
	[ACTUALIZADO_POR] [uniqueidentifier] NULL,
 CONSTRAINT [PK_TAREA] PRIMARY KEY CLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]
GO
SET IDENTITY_INSERT [dbo].[AUDITORIA_TAREAS] ON 

INSERT [dbo].[AUDITORIA_TAREAS] ([ID], [USUARIO_ID], [USUARIO_NOMBRE], [ROL_CODIGO], [UNIDAD_ID], [ACCION], [ENTIDAD], [ENTIDAD_ID], [DATOS_ANTERIORES], [DATOS_NUEVOS], [DIRECCION_IP], [AGENTE_USUARIO], [RESULTADO], [DETALLE], [CREADO_EN]) VALUES (1, N'30000000-0000-0000-0000-000000000002', N'María Elena García Pérez', N'SUPERVISOR', N'10000000-0000-0000-0000-000000000001', N'CREAR_TAREA', N'TAREA', N'50000000-0000-0000-0000-000000000001', NULL, N'{"titulo":"Actualizar manual de bienvenida"}', NULL, NULL, N'EXITOSO', NULL, CAST(N'2026-01-21T03:03:59.2109957' AS DateTime2))
INSERT [dbo].[AUDITORIA_TAREAS] ([ID], [USUARIO_ID], [USUARIO_NOMBRE], [ROL_CODIGO], [UNIDAD_ID], [ACCION], [ENTIDAD], [ENTIDAD_ID], [DATOS_ANTERIORES], [DATOS_NUEVOS], [DIRECCION_IP], [AGENTE_USUARIO], [RESULTADO], [DETALLE], [CREADO_EN]) VALUES (2, N'30000000-0000-0000-0000-000000000003', N'Roberto Hernández Díaz', N'SUPERVISOR', N'10000000-0000-0000-0000-000000000002', N'CREAR_TAREA', N'TAREA', N'50000000-0000-0000-0000-000000000006', NULL, N'{"titulo":"Cierre contable enero 2026"}', NULL, NULL, N'EXITOSO', NULL, CAST(N'2026-01-16T03:03:59.2109957' AS DateTime2))
INSERT [dbo].[AUDITORIA_TAREAS] ([ID], [USUARIO_ID], [USUARIO_NOMBRE], [ROL_CODIGO], [UNIDAD_ID], [ACCION], [ENTIDAD], [ENTIDAD_ID], [DATOS_ANTERIORES], [DATOS_NUEVOS], [DIRECCION_IP], [AGENTE_USUARIO], [RESULTADO], [DETALLE], [CREADO_EN]) VALUES (3, N'30000000-0000-0000-0000-000000000001', N'Carlos Ramírez López', N'ADMIN', N'10000000-0000-0000-0000-000000000004', N'CREAR_TAREA', N'TAREA', N'50000000-0000-0000-0000-000000000013', NULL, N'{"titulo":"Migración servidor correo"}', NULL, NULL, N'EXITOSO', NULL, CAST(N'2026-01-18T03:03:59.2109957' AS DateTime2))
INSERT [dbo].[AUDITORIA_TAREAS] ([ID], [USUARIO_ID], [USUARIO_NOMBRE], [ROL_CODIGO], [UNIDAD_ID], [ACCION], [ENTIDAD], [ENTIDAD_ID], [DATOS_ANTERIORES], [DATOS_NUEVOS], [DIRECCION_IP], [AGENTE_USUARIO], [RESULTADO], [DETALLE], [CREADO_EN]) VALUES (4, N'30000000-0000-0000-0000-000000000005', N'Luis Fernando Torres Vega', N'ESTANDAR', N'10000000-0000-0000-0000-000000000001', N'CREAR_SOLICITUD', N'SOLICITUD_APROBACION', N'60000000-0000-0000-0000-000000000001', NULL, NULL, NULL, NULL, N'EXITOSO', N'Solicitud de creación de tarea', CAST(N'2026-01-30T03:03:59.2109957' AS DateTime2))
INSERT [dbo].[AUDITORIA_TAREAS] ([ID], [USUARIO_ID], [USUARIO_NOMBRE], [ROL_CODIGO], [UNIDAD_ID], [ACCION], [ENTIDAD], [ENTIDAD_ID], [DATOS_ANTERIORES], [DATOS_NUEVOS], [DIRECCION_IP], [AGENTE_USUARIO], [RESULTADO], [DETALLE], [CREADO_EN]) VALUES (5, N'30000000-0000-0000-0000-000000000007', N'Jorge Alberto Mendoza Ríos', N'ESTANDAR', N'10000000-0000-0000-0000-000000000002', N'CREAR_SOLICITUD', N'SOLICITUD_APROBACION', N'60000000-0000-0000-0000-000000000003', NULL, NULL, NULL, NULL, N'EXITOSO', N'Solicitud de creación de tarea', CAST(N'2026-02-11T03:03:59.2109957' AS DateTime2))
INSERT [dbo].[AUDITORIA_TAREAS] ([ID], [USUARIO_ID], [USUARIO_NOMBRE], [ROL_CODIGO], [UNIDAD_ID], [ACCION], [ENTIDAD], [ENTIDAD_ID], [DATOS_ANTERIORES], [DATOS_NUEVOS], [DIRECCION_IP], [AGENTE_USUARIO], [RESULTADO], [DETALLE], [CREADO_EN]) VALUES (6, N'30000000-0000-0000-0000-000000000002', N'María Elena García Pérez', N'SUPERVISOR', N'10000000-0000-0000-0000-000000000001', N'APROBAR_SOLICITUD', N'SOLICITUD_APROBACION', N'60000000-0000-0000-0000-000000000001', NULL, NULL, NULL, NULL, N'EXITOSO', N'Tipo: CREAR | Tarea: 50000000-0000-0000-0000-000000000003', CAST(N'2026-02-01T03:03:59.2109957' AS DateTime2))
INSERT [dbo].[AUDITORIA_TAREAS] ([ID], [USUARIO_ID], [USUARIO_NOMBRE], [ROL_CODIGO], [UNIDAD_ID], [ACCION], [ENTIDAD], [ENTIDAD_ID], [DATOS_ANTERIORES], [DATOS_NUEVOS], [DIRECCION_IP], [AGENTE_USUARIO], [RESULTADO], [DETALLE], [CREADO_EN]) VALUES (7, N'30000000-0000-0000-0000-000000000003', N'Roberto Hernández Díaz', N'SUPERVISOR', N'10000000-0000-0000-0000-000000000002', N'APROBAR_SOLICITUD', N'SOLICITUD_APROBACION', N'60000000-0000-0000-0000-000000000003', NULL, NULL, NULL, NULL, N'EXITOSO', N'Tipo: CREAR | Tarea: 50000000-0000-0000-0000-000000000008', CAST(N'2026-02-13T03:03:59.2109957' AS DateTime2))
INSERT [dbo].[AUDITORIA_TAREAS] ([ID], [USUARIO_ID], [USUARIO_NOMBRE], [ROL_CODIGO], [UNIDAD_ID], [ACCION], [ENTIDAD], [ENTIDAD_ID], [DATOS_ANTERIORES], [DATOS_NUEVOS], [DIRECCION_IP], [AGENTE_USUARIO], [RESULTADO], [DETALLE], [CREADO_EN]) VALUES (8, N'30000000-0000-0000-0000-000000000002', N'María Elena García Pérez', N'SUPERVISOR', N'10000000-0000-0000-0000-000000000001', N'RECHAZAR_SOLICITUD', N'SOLICITUD_APROBACION', N'60000000-0000-0000-0000-000000000004', NULL, NULL, NULL, NULL, N'EXITOSO', N'Motivo: No corresponde al módulo de tareas', CAST(N'2026-02-02T03:03:59.2109957' AS DateTime2))
INSERT [dbo].[AUDITORIA_TAREAS] ([ID], [USUARIO_ID], [USUARIO_NOMBRE], [ROL_CODIGO], [UNIDAD_ID], [ACCION], [ENTIDAD], [ENTIDAD_ID], [DATOS_ANTERIORES], [DATOS_NUEVOS], [DIRECCION_IP], [AGENTE_USUARIO], [RESULTADO], [DETALLE], [CREADO_EN]) VALUES (9, N'30000000-0000-0000-0000-000000000003', N'Roberto Hernández Díaz', N'SUPERVISOR', N'10000000-0000-0000-0000-000000000002', N'RECHAZAR_SOLICITUD', N'SOLICITUD_APROBACION', N'60000000-0000-0000-0000-000000000005', NULL, NULL, NULL, NULL, N'EXITOSO', N'Motivo: Falta evidencia de gerencia', CAST(N'2026-02-05T03:03:59.2109957' AS DateTime2))
INSERT [dbo].[AUDITORIA_TAREAS] ([ID], [USUARIO_ID], [USUARIO_NOMBRE], [ROL_CODIGO], [UNIDAD_ID], [ACCION], [ENTIDAD], [ENTIDAD_ID], [DATOS_ANTERIORES], [DATOS_NUEVOS], [DIRECCION_IP], [AGENTE_USUARIO], [RESULTADO], [DETALLE], [CREADO_EN]) VALUES (10, N'30000000-0000-0000-0000-000000000004', N'Ana Sofía Martínez Ruiz', N'SUPERVISOR', N'10000000-0000-0000-0000-000000000003', N'APROBAR_SOLICITUD', N'SOLICITUD_APROBACION', N'60000000-0000-0000-0000-000000000006', NULL, NULL, NULL, NULL, N'DENEGADO', N'Unidad diferente a la del supervisor', CAST(N'2026-02-14T03:03:59.2109957' AS DateTime2))
INSERT [dbo].[AUDITORIA_TAREAS] ([ID], [USUARIO_ID], [USUARIO_NOMBRE], [ROL_CODIGO], [UNIDAD_ID], [ACCION], [ENTIDAD], [ENTIDAD_ID], [DATOS_ANTERIORES], [DATOS_NUEVOS], [DIRECCION_IP], [AGENTE_USUARIO], [RESULTADO], [DETALLE], [CREADO_EN]) VALUES (11, N'30000000-0000-0000-0000-000000000002', N'María Elena García Pérez', N'SUPERVISOR', N'10000000-0000-0000-0000-000000000001', N'EDITAR_TAREA', N'TAREA', N'50000000-0000-0000-0000-000000000002', NULL, N'{"prioridad":"ALTA"}', NULL, NULL, N'EXITOSO', NULL, CAST(N'2026-02-03T03:03:59.2109957' AS DateTime2))
INSERT [dbo].[AUDITORIA_TAREAS] ([ID], [USUARIO_ID], [USUARIO_NOMBRE], [ROL_CODIGO], [UNIDAD_ID], [ACCION], [ENTIDAD], [ENTIDAD_ID], [DATOS_ANTERIORES], [DATOS_NUEVOS], [DIRECCION_IP], [AGENTE_USUARIO], [RESULTADO], [DETALLE], [CREADO_EN]) VALUES (12, N'30000000-0000-0000-0000-000000000002', N'María Elena García Pérez', N'SUPERVISOR', N'10000000-0000-0000-0000-000000000001', N'COMPLETAR_TAREA', N'TAREA', N'50000000-0000-0000-0000-000000000001', NULL, NULL, NULL, NULL, N'EXITOSO', NULL, CAST(N'2026-02-08T03:03:59.2109957' AS DateTime2))
INSERT [dbo].[AUDITORIA_TAREAS] ([ID], [USUARIO_ID], [USUARIO_NOMBRE], [ROL_CODIGO], [UNIDAD_ID], [ACCION], [ENTIDAD], [ENTIDAD_ID], [DATOS_ANTERIORES], [DATOS_NUEVOS], [DIRECCION_IP], [AGENTE_USUARIO], [RESULTADO], [DETALLE], [CREADO_EN]) VALUES (13, N'30000000-0000-0000-0000-000000000003', N'Roberto Hernández Díaz', N'SUPERVISOR', N'10000000-0000-0000-0000-000000000002', N'COMPLETAR_TAREA', N'TAREA', N'50000000-0000-0000-0000-000000000006', NULL, NULL, NULL, NULL, N'EXITOSO', NULL, CAST(N'2026-02-10T03:03:59.2109957' AS DateTime2))
INSERT [dbo].[AUDITORIA_TAREAS] ([ID], [USUARIO_ID], [USUARIO_NOMBRE], [ROL_CODIGO], [UNIDAD_ID], [ACCION], [ENTIDAD], [ENTIDAD_ID], [DATOS_ANTERIORES], [DATOS_NUEVOS], [DIRECCION_IP], [AGENTE_USUARIO], [RESULTADO], [DETALLE], [CREADO_EN]) VALUES (14, N'30000000-0000-0000-0000-000000000001', N'Carlos Ramírez López', N'ADMIN', N'10000000-0000-0000-0000-000000000004', N'EJECUTAR_REPORTE', N'REPORTE', N'RPT_PRODUCTIVIDAD_UNIDAD', NULL, N'{"fecha_desde":"2026-01-01"}', NULL, NULL, N'EXITOSO', N'SP: sp_REPORTE_PRODUCTIVIDAD_UNIDAD', CAST(N'2026-02-14T03:03:59.2109957' AS DateTime2))
INSERT [dbo].[AUDITORIA_TAREAS] ([ID], [USUARIO_ID], [USUARIO_NOMBRE], [ROL_CODIGO], [UNIDAD_ID], [ACCION], [ENTIDAD], [ENTIDAD_ID], [DATOS_ANTERIORES], [DATOS_NUEVOS], [DIRECCION_IP], [AGENTE_USUARIO], [RESULTADO], [DETALLE], [CREADO_EN]) VALUES (15, N'30000000-0000-0000-0000-000000000002', N'María Elena García Pérez', N'SUPERVISOR', N'10000000-0000-0000-0000-000000000001', N'EJECUTAR_REPORTE', N'REPORTE', N'RPT_SOLICITUDES_APROBADAS', NULL, NULL, NULL, NULL, N'EXITOSO', N'SP: sp_REPORTE_SOLICITUDES_APROBADAS', CAST(N'2026-02-14T22:03:59.2109957' AS DateTime2))
SET IDENTITY_INSERT [dbo].[AUDITORIA_TAREAS] OFF
GO
INSERT [dbo].[ESTADO_TAREA] ([ID], [NOMBRE], [COLOR], [ORDEN], [ES_DEFECTO], [ESTA_ACTIVO], [CREADO_EN], [ACTUALIZADO_EN], [ELIMINADO_EN], [CREADO_POR]) VALUES (N'40000000-0000-0000-0000-000000000001', N'Nueva', N'#6B7280', 1, 1, 1, CAST(N'2026-02-15T03:03:59.1995061' AS DateTime2), CAST(N'2026-02-15T03:03:59.1995061' AS DateTime2), NULL, NULL)
INSERT [dbo].[ESTADO_TAREA] ([ID], [NOMBRE], [COLOR], [ORDEN], [ES_DEFECTO], [ESTA_ACTIVO], [CREADO_EN], [ACTUALIZADO_EN], [ELIMINADO_EN], [CREADO_POR]) VALUES (N'40000000-0000-0000-0000-000000000002', N'Pendiente', N'#F59E0B', 2, 0, 1, CAST(N'2026-02-15T03:03:59.1995061' AS DateTime2), CAST(N'2026-02-15T03:03:59.1995061' AS DateTime2), NULL, NULL)
INSERT [dbo].[ESTADO_TAREA] ([ID], [NOMBRE], [COLOR], [ORDEN], [ES_DEFECTO], [ESTA_ACTIVO], [CREADO_EN], [ACTUALIZADO_EN], [ELIMINADO_EN], [CREADO_POR]) VALUES (N'40000000-0000-0000-0000-000000000003', N'En Progreso', N'#3B82F6', 3, 0, 1, CAST(N'2026-02-15T03:03:59.1995061' AS DateTime2), CAST(N'2026-02-15T03:03:59.1995061' AS DateTime2), NULL, NULL)
INSERT [dbo].[ESTADO_TAREA] ([ID], [NOMBRE], [COLOR], [ORDEN], [ES_DEFECTO], [ESTA_ACTIVO], [CREADO_EN], [ACTUALIZADO_EN], [ELIMINADO_EN], [CREADO_POR]) VALUES (N'40000000-0000-0000-0000-000000000004', N'Completada', N'#10B981', 4, 0, 1, CAST(N'2026-02-15T03:03:59.1995061' AS DateTime2), CAST(N'2026-02-15T03:03:59.1995061' AS DateTime2), NULL, NULL)
GO
SET IDENTITY_INSERT [dbo].[HISTORIAL_TAREA] ON 

INSERT [dbo].[HISTORIAL_TAREA] ([ID], [TAREA_ID], [ACCION], [DATOS_ANTERIORES], [DATOS_NUEVOS], [SOLICITUD_ID], [REALIZADO_POR], [CREADO_EN]) VALUES (1, N'50000000-0000-0000-0000-000000000001', N'CREADA', NULL, N'{"titulo":"Actualizar manual de bienvenida","prioridad":"ALTA"}', NULL, N'30000000-0000-0000-0000-000000000002', CAST(N'2026-01-21T03:03:59.2039869' AS DateTime2))
INSERT [dbo].[HISTORIAL_TAREA] ([ID], [TAREA_ID], [ACCION], [DATOS_ANTERIORES], [DATOS_NUEVOS], [SOLICITUD_ID], [REALIZADO_POR], [CREADO_EN]) VALUES (2, N'50000000-0000-0000-0000-000000000002', N'CREADA', NULL, N'{"titulo":"Evaluaciones de desempeño Q1","prioridad":"ALTA"}', NULL, N'30000000-0000-0000-0000-000000000002', CAST(N'2026-01-26T03:03:59.2039869' AS DateTime2))
INSERT [dbo].[HISTORIAL_TAREA] ([ID], [TAREA_ID], [ACCION], [DATOS_ANTERIORES], [DATOS_NUEVOS], [SOLICITUD_ID], [REALIZADO_POR], [CREADO_EN]) VALUES (3, N'50000000-0000-0000-0000-000000000003', N'CREADA', NULL, N'{"titulo":"Capacitación seguridad informática","prioridad":"MEDIA"}', NULL, N'30000000-0000-0000-0000-000000000005', CAST(N'2026-01-31T03:03:59.2039869' AS DateTime2))
INSERT [dbo].[HISTORIAL_TAREA] ([ID], [TAREA_ID], [ACCION], [DATOS_ANTERIORES], [DATOS_NUEVOS], [SOLICITUD_ID], [REALIZADO_POR], [CREADO_EN]) VALUES (4, N'50000000-0000-0000-0000-000000000004', N'CREADA', NULL, N'{"titulo":"Revisión contratos vencidos","prioridad":"ALTA"}', NULL, N'30000000-0000-0000-0000-000000000006', CAST(N'2026-02-05T03:03:59.2039869' AS DateTime2))
INSERT [dbo].[HISTORIAL_TAREA] ([ID], [TAREA_ID], [ACCION], [DATOS_ANTERIORES], [DATOS_NUEVOS], [SOLICITUD_ID], [REALIZADO_POR], [CREADO_EN]) VALUES (5, N'50000000-0000-0000-0000-000000000005', N'CREADA', NULL, N'{"titulo":"Encuesta clima laboral","prioridad":"MEDIA"}', NULL, N'30000000-0000-0000-0000-000000000002', CAST(N'2026-02-10T03:03:59.2039869' AS DateTime2))
INSERT [dbo].[HISTORIAL_TAREA] ([ID], [TAREA_ID], [ACCION], [DATOS_ANTERIORES], [DATOS_NUEVOS], [SOLICITUD_ID], [REALIZADO_POR], [CREADO_EN]) VALUES (6, N'50000000-0000-0000-0000-000000000006', N'CREADA', NULL, N'{"titulo":"Cierre contable enero 2026","prioridad":"ALTA"}', NULL, N'30000000-0000-0000-0000-000000000003', CAST(N'2026-01-16T03:03:59.2039869' AS DateTime2))
INSERT [dbo].[HISTORIAL_TAREA] ([ID], [TAREA_ID], [ACCION], [DATOS_ANTERIORES], [DATOS_NUEVOS], [SOLICITUD_ID], [REALIZADO_POR], [CREADO_EN]) VALUES (7, N'50000000-0000-0000-0000-000000000007', N'CREADA', NULL, N'{"titulo":"Presupuesto Q2 2026","prioridad":"ALTA"}', NULL, N'30000000-0000-0000-0000-000000000003', CAST(N'2026-01-28T03:03:59.2039869' AS DateTime2))
INSERT [dbo].[HISTORIAL_TAREA] ([ID], [TAREA_ID], [ACCION], [DATOS_ANTERIORES], [DATOS_NUEVOS], [SOLICITUD_ID], [REALIZADO_POR], [CREADO_EN]) VALUES (8, N'50000000-0000-0000-0000-000000000008', N'CREADA', NULL, N'{"titulo":"Conciliación bancaria febrero","prioridad":"MEDIA"}', NULL, N'30000000-0000-0000-0000-000000000007', CAST(N'2026-02-12T03:03:59.2039869' AS DateTime2))
INSERT [dbo].[HISTORIAL_TAREA] ([ID], [TAREA_ID], [ACCION], [DATOS_ANTERIORES], [DATOS_NUEVOS], [SOLICITUD_ID], [REALIZADO_POR], [CREADO_EN]) VALUES (9, N'50000000-0000-0000-0000-000000000009', N'CREADA', NULL, N'{"titulo":"Auditoría gastos representación","prioridad":"BAJA"}', NULL, N'30000000-0000-0000-0000-000000000008', CAST(N'2026-02-03T03:03:59.2039869' AS DateTime2))
INSERT [dbo].[HISTORIAL_TAREA] ([ID], [TAREA_ID], [ACCION], [DATOS_ANTERIORES], [DATOS_NUEVOS], [SOLICITUD_ID], [REALIZADO_POR], [CREADO_EN]) VALUES (10, N'50000000-0000-0000-0000-000000000010', N'CREADA', NULL, N'{"titulo":"Dashboard ventas Power BI","prioridad":"ALTA"}', NULL, N'30000000-0000-0000-0000-000000000004', CAST(N'2026-01-24T03:03:59.2039869' AS DateTime2))
INSERT [dbo].[HISTORIAL_TAREA] ([ID], [TAREA_ID], [ACCION], [DATOS_ANTERIORES], [DATOS_NUEVOS], [SOLICITUD_ID], [REALIZADO_POR], [CREADO_EN]) VALUES (11, N'50000000-0000-0000-0000-000000000011', N'CREADA', NULL, N'{"titulo":"ETL fuente datos SAP","prioridad":"ALTA"}', NULL, N'30000000-0000-0000-0000-000000000009', CAST(N'2026-02-01T03:03:59.2039869' AS DateTime2))
INSERT [dbo].[HISTORIAL_TAREA] ([ID], [TAREA_ID], [ACCION], [DATOS_ANTERIORES], [DATOS_NUEVOS], [SOLICITUD_ID], [REALIZADO_POR], [CREADO_EN]) VALUES (12, N'50000000-0000-0000-0000-000000000012', N'CREADA', NULL, N'{"titulo":"Informe KPIs mensual","prioridad":"MEDIA"}', NULL, N'30000000-0000-0000-0000-000000000004', CAST(N'2026-02-07T03:03:59.2039869' AS DateTime2))
INSERT [dbo].[HISTORIAL_TAREA] ([ID], [TAREA_ID], [ACCION], [DATOS_ANTERIORES], [DATOS_NUEVOS], [SOLICITUD_ID], [REALIZADO_POR], [CREADO_EN]) VALUES (13, N'50000000-0000-0000-0000-000000000013', N'CREADA', NULL, N'{"titulo":"Migración servidor correo","prioridad":"ALTA"}', NULL, N'30000000-0000-0000-0000-000000000001', CAST(N'2026-01-18T03:03:59.2039869' AS DateTime2))
INSERT [dbo].[HISTORIAL_TAREA] ([ID], [TAREA_ID], [ACCION], [DATOS_ANTERIORES], [DATOS_NUEVOS], [SOLICITUD_ID], [REALIZADO_POR], [CREADO_EN]) VALUES (14, N'50000000-0000-0000-0000-000000000014', N'CREADA', NULL, N'{"titulo":"Actualizar firewalls","prioridad":"ALTA"}', NULL, N'30000000-0000-0000-0000-000000000010', CAST(N'2026-01-30T03:03:59.2039869' AS DateTime2))
INSERT [dbo].[HISTORIAL_TAREA] ([ID], [TAREA_ID], [ACCION], [DATOS_ANTERIORES], [DATOS_NUEVOS], [SOLICITUD_ID], [REALIZADO_POR], [CREADO_EN]) VALUES (15, N'50000000-0000-0000-0000-000000000015', N'CREADA', NULL, N'{"titulo":"Inventario licencias software","prioridad":"BAJA"}', NULL, N'30000000-0000-0000-0000-000000000001', CAST(N'2026-02-13T03:03:59.2039869' AS DateTime2))
INSERT [dbo].[HISTORIAL_TAREA] ([ID], [TAREA_ID], [ACCION], [DATOS_ANTERIORES], [DATOS_NUEVOS], [SOLICITUD_ID], [REALIZADO_POR], [CREADO_EN]) VALUES (16, N'50000000-0000-0000-0000-000000000001', N'COMPLETADA', NULL, NULL, NULL, N'30000000-0000-0000-0000-000000000002', CAST(N'2026-02-08T03:03:59.2059477' AS DateTime2))
INSERT [dbo].[HISTORIAL_TAREA] ([ID], [TAREA_ID], [ACCION], [DATOS_ANTERIORES], [DATOS_NUEVOS], [SOLICITUD_ID], [REALIZADO_POR], [CREADO_EN]) VALUES (17, N'50000000-0000-0000-0000-000000000006', N'COMPLETADA', NULL, NULL, NULL, N'30000000-0000-0000-0000-000000000003', CAST(N'2026-02-10T03:03:59.2059477' AS DateTime2))
INSERT [dbo].[HISTORIAL_TAREA] ([ID], [TAREA_ID], [ACCION], [DATOS_ANTERIORES], [DATOS_NUEVOS], [SOLICITUD_ID], [REALIZADO_POR], [CREADO_EN]) VALUES (18, N'50000000-0000-0000-0000-000000000012', N'COMPLETADA', NULL, NULL, NULL, N'30000000-0000-0000-0000-000000000004', CAST(N'2026-02-13T03:03:59.2059477' AS DateTime2))
INSERT [dbo].[HISTORIAL_TAREA] ([ID], [TAREA_ID], [ACCION], [DATOS_ANTERIORES], [DATOS_NUEVOS], [SOLICITUD_ID], [REALIZADO_POR], [CREADO_EN]) VALUES (19, N'50000000-0000-0000-0000-000000000002', N'EDITADA', N'{"prioridad":"MEDIA"}', N'{"prioridad":"ALTA"}', NULL, N'30000000-0000-0000-0000-000000000002', CAST(N'2026-02-03T03:03:59.2069497' AS DateTime2))
INSERT [dbo].[HISTORIAL_TAREA] ([ID], [TAREA_ID], [ACCION], [DATOS_ANTERIORES], [DATOS_NUEVOS], [SOLICITUD_ID], [REALIZADO_POR], [CREADO_EN]) VALUES (20, N'50000000-0000-0000-0000-000000000007', N'EDITADA', N'{"titulo":"Presupuesto Q2"}', N'{"titulo":"Presupuesto Q2 2026"}', NULL, N'30000000-0000-0000-0000-000000000003', CAST(N'2026-02-05T03:03:59.2069497' AS DateTime2))
SET IDENTITY_INSERT [dbo].[HISTORIAL_TAREA] OFF
GO
INSERT [dbo].[SOLICITUD_APROBACION] ([ID], [TAREA_ID], [TIPO_ACCION], [TITULO], [DESCRIPCION], [ESTADO_ID], [PRIORIDAD], [UNIDAD_ID], [SOLICITANTE_ID], [ESTADO_SOLICITUD], [APROBADO_POR], [FECHA_RESOLUCION], [MOTIVO_RECHAZO], [CREADO_EN]) VALUES (N'60000000-0000-0000-0000-000000000001', N'50000000-0000-0000-0000-000000000003', N'CREAR', N'Capacitación seguridad informática', N'Organizar taller de seguridad informática para todo el personal', N'40000000-0000-0000-0000-000000000002', N'MEDIA', N'10000000-0000-0000-0000-000000000001', N'30000000-0000-0000-0000-000000000005', N'APROBADA', N'30000000-0000-0000-0000-000000000002', CAST(N'2026-02-01T03:03:59.2089509' AS DateTime2), NULL, CAST(N'2026-01-30T03:03:59.2089509' AS DateTime2))
INSERT [dbo].[SOLICITUD_APROBACION] ([ID], [TAREA_ID], [TIPO_ACCION], [TITULO], [DESCRIPCION], [ESTADO_ID], [PRIORIDAD], [UNIDAD_ID], [SOLICITANTE_ID], [ESTADO_SOLICITUD], [APROBADO_POR], [FECHA_RESOLUCION], [MOTIVO_RECHAZO], [CREADO_EN]) VALUES (N'60000000-0000-0000-0000-000000000002', N'50000000-0000-0000-0000-000000000004', N'CREAR', N'Revisión contratos vencidos', N'Identificar contratos laborales que vencen en marzo 2026', N'40000000-0000-0000-0000-000000000001', N'ALTA', N'10000000-0000-0000-0000-000000000001', N'30000000-0000-0000-0000-000000000006', N'APROBADA', N'30000000-0000-0000-0000-000000000002', CAST(N'2026-02-06T03:03:59.2089509' AS DateTime2), NULL, CAST(N'2026-02-04T03:03:59.2089509' AS DateTime2))
INSERT [dbo].[SOLICITUD_APROBACION] ([ID], [TAREA_ID], [TIPO_ACCION], [TITULO], [DESCRIPCION], [ESTADO_ID], [PRIORIDAD], [UNIDAD_ID], [SOLICITANTE_ID], [ESTADO_SOLICITUD], [APROBADO_POR], [FECHA_RESOLUCION], [MOTIVO_RECHAZO], [CREADO_EN]) VALUES (N'60000000-0000-0000-0000-000000000003', N'50000000-0000-0000-0000-000000000008', N'CREAR', N'Conciliación bancaria febrero', N'Conciliar las cuentas bancarias del mes de febrero', N'40000000-0000-0000-0000-000000000001', N'MEDIA', N'10000000-0000-0000-0000-000000000002', N'30000000-0000-0000-0000-000000000007', N'APROBADA', N'30000000-0000-0000-0000-000000000003', CAST(N'2026-02-13T03:03:59.2089509' AS DateTime2), NULL, CAST(N'2026-02-11T03:03:59.2089509' AS DateTime2))
INSERT [dbo].[SOLICITUD_APROBACION] ([ID], [TAREA_ID], [TIPO_ACCION], [TITULO], [DESCRIPCION], [ESTADO_ID], [PRIORIDAD], [UNIDAD_ID], [SOLICITANTE_ID], [ESTADO_SOLICITUD], [APROBADO_POR], [FECHA_RESOLUCION], [MOTIVO_RECHAZO], [CREADO_EN]) VALUES (N'60000000-0000-0000-0000-000000000004', NULL, N'CREAR', N'Comprar sillas nuevas', N'Solicitar 50 sillas ergonómicas para la oficina de RRHH', NULL, N'BAJA', N'10000000-0000-0000-0000-000000000001', N'30000000-0000-0000-0000-000000000005', N'RECHAZADA', N'30000000-0000-0000-0000-000000000002', CAST(N'2026-02-02T03:03:59.2089509' AS DateTime2), N'Esta solicitud no corresponde al módulo de tareas. Debe gestionarse por el área de Compras a través del formulario de requisiciones.', CAST(N'2026-01-31T03:03:59.2089509' AS DateTime2))
INSERT [dbo].[SOLICITUD_APROBACION] ([ID], [TAREA_ID], [TIPO_ACCION], [TITULO], [DESCRIPCION], [ESTADO_ID], [PRIORIDAD], [UNIDAD_ID], [SOLICITANTE_ID], [ESTADO_SOLICITUD], [APROBADO_POR], [FECHA_RESOLUCION], [MOTIVO_RECHAZO], [CREADO_EN]) VALUES (N'60000000-0000-0000-0000-000000000005', N'50000000-0000-0000-0000-000000000009', N'EDITAR', N'Auditoría gastos representación URGENTE', N'Cambiar prioridad a ALTA por solicitud de gerencia general', N'40000000-0000-0000-0000-000000000002', N'ALTA', N'10000000-0000-0000-0000-000000000002', N'30000000-0000-0000-0000-000000000008', N'RECHAZADA', N'30000000-0000-0000-0000-000000000003', CAST(N'2026-02-05T03:03:59.2089509' AS DateTime2), N'No se puede cambiar la prioridad sin adjuntar el correo de gerencia que lo autoriza. Por favor reenvíe con la evidencia adjunta.', CAST(N'2026-02-04T03:03:59.2089509' AS DateTime2))
INSERT [dbo].[SOLICITUD_APROBACION] ([ID], [TAREA_ID], [TIPO_ACCION], [TITULO], [DESCRIPCION], [ESTADO_ID], [PRIORIDAD], [UNIDAD_ID], [SOLICITANTE_ID], [ESTADO_SOLICITUD], [APROBADO_POR], [FECHA_RESOLUCION], [MOTIVO_RECHAZO], [CREADO_EN]) VALUES (N'60000000-0000-0000-0000-000000000006', NULL, N'CREAR', N'Programa de mentoring interno', N'Diseñar programa de mentoring entre colaboradores senior y junior', NULL, N'MEDIA', N'10000000-0000-0000-0000-000000000001', N'30000000-0000-0000-0000-000000000006', N'PENDIENTE', NULL, NULL, NULL, CAST(N'2026-02-13T15:03:59.2089509' AS DateTime2))
INSERT [dbo].[SOLICITUD_APROBACION] ([ID], [TAREA_ID], [TIPO_ACCION], [TITULO], [DESCRIPCION], [ESTADO_ID], [PRIORIDAD], [UNIDAD_ID], [SOLICITANTE_ID], [ESTADO_SOLICITUD], [APROBADO_POR], [FECHA_RESOLUCION], [MOTIVO_RECHAZO], [CREADO_EN]) VALUES (N'60000000-0000-0000-0000-000000000007', N'50000000-0000-0000-0000-000000000009', N'COMPLETAR', N'Auditoría gastos representación', N'Revisión finalizada, adjuntar reporte en la carpeta compartida', N'40000000-0000-0000-0000-000000000002', N'BAJA', N'10000000-0000-0000-0000-000000000002', N'30000000-0000-0000-0000-000000000008', N'PENDIENTE', NULL, NULL, NULL, CAST(N'2026-02-14T09:03:59.2089509' AS DateTime2))
INSERT [dbo].[SOLICITUD_APROBACION] ([ID], [TAREA_ID], [TIPO_ACCION], [TITULO], [DESCRIPCION], [ESTADO_ID], [PRIORIDAD], [UNIDAD_ID], [SOLICITANTE_ID], [ESTADO_SOLICITUD], [APROBADO_POR], [FECHA_RESOLUCION], [MOTIVO_RECHAZO], [CREADO_EN]) VALUES (N'60000000-0000-0000-0000-000000000008', NULL, N'CREAR', N'Análisis churn rate clientes', N'Analizar tasa de abandono de clientes del último trimestre', NULL, N'ALTA', N'10000000-0000-0000-0000-000000000003', N'30000000-0000-0000-0000-000000000009', N'PENDIENTE', NULL, NULL, NULL, CAST(N'2026-02-14T15:03:59.2089509' AS DateTime2))
INSERT [dbo].[SOLICITUD_APROBACION] ([ID], [TAREA_ID], [TIPO_ACCION], [TITULO], [DESCRIPCION], [ESTADO_ID], [PRIORIDAD], [UNIDAD_ID], [SOLICITANTE_ID], [ESTADO_SOLICITUD], [APROBADO_POR], [FECHA_RESOLUCION], [MOTIVO_RECHAZO], [CREADO_EN]) VALUES (N'60000000-0000-0000-0000-000000000009', N'50000000-0000-0000-0000-000000000011', N'EDITAR', N'ETL fuente datos SAP - Cambiar conexión', N'Cambiar a conexión por API REST en lugar de ODBC por problemas de rendimiento', N'40000000-0000-0000-0000-000000000001', N'ALTA', N'10000000-0000-0000-0000-000000000003', N'30000000-0000-0000-0000-000000000009', N'PENDIENTE', NULL, NULL, NULL, CAST(N'2026-02-14T21:03:59.2089509' AS DateTime2))
INSERT [dbo].[SOLICITUD_APROBACION] ([ID], [TAREA_ID], [TIPO_ACCION], [TITULO], [DESCRIPCION], [ESTADO_ID], [PRIORIDAD], [UNIDAD_ID], [SOLICITANTE_ID], [ESTADO_SOLICITUD], [APROBADO_POR], [FECHA_RESOLUCION], [MOTIVO_RECHAZO], [CREADO_EN]) VALUES (N'60000000-0000-0000-0000-000000000010', N'50000000-0000-0000-0000-000000000014', N'ELIMINAR', N'Actualizar firewalls', N'Tarea duplicada, ya existe en el sistema de tickets de TI (JIRA-4521)', N'40000000-0000-0000-0000-000000000002', N'ALTA', N'10000000-0000-0000-0000-000000000004', N'30000000-0000-0000-0000-000000000010', N'PENDIENTE', NULL, NULL, NULL, CAST(N'2026-02-15T01:03:59.2089509' AS DateTime2))
GO
INSERT [dbo].[TAREA] ([ID], [TITULO], [DESCRIPCION], [ESTADO_ID], [PRIORIDAD], [UNIDAD_ID], [CREADO_POR], [ASIGNADO_A], [FECHA_CREACION], [ACTUALIZADO_EN], [ELIMINADO_EN], [ACTUALIZADO_POR]) VALUES (N'50000000-0000-0000-0000-000000000001', N'Actualizar manual de bienvenida', N'Revisar y actualizar el manual de inducción para nuevos colaboradores', N'40000000-0000-0000-0000-000000000004', N'ALTA', N'10000000-0000-0000-0000-000000000001', N'30000000-0000-0000-0000-000000000002', NULL, CAST(N'2026-01-21T03:03:59.2019920' AS DateTime2), CAST(N'2026-02-15T03:03:59.2019920' AS DateTime2), NULL, NULL)
INSERT [dbo].[TAREA] ([ID], [TITULO], [DESCRIPCION], [ESTADO_ID], [PRIORIDAD], [UNIDAD_ID], [CREADO_POR], [ASIGNADO_A], [FECHA_CREACION], [ACTUALIZADO_EN], [ELIMINADO_EN], [ACTUALIZADO_POR]) VALUES (N'50000000-0000-0000-0000-000000000002', N'Evaluaciones de desempeño Q1', N'Coordinar las evaluaciones de desempeño del primer trimestre 2026', N'40000000-0000-0000-0000-000000000003', N'ALTA', N'10000000-0000-0000-0000-000000000001', N'30000000-0000-0000-0000-000000000002', NULL, CAST(N'2026-01-26T03:03:59.2019920' AS DateTime2), CAST(N'2026-02-15T03:03:59.2019920' AS DateTime2), NULL, NULL)
INSERT [dbo].[TAREA] ([ID], [TITULO], [DESCRIPCION], [ESTADO_ID], [PRIORIDAD], [UNIDAD_ID], [CREADO_POR], [ASIGNADO_A], [FECHA_CREACION], [ACTUALIZADO_EN], [ELIMINADO_EN], [ACTUALIZADO_POR]) VALUES (N'50000000-0000-0000-0000-000000000003', N'Capacitación seguridad informática', N'Organizar taller de seguridad informática para todo el personal', N'40000000-0000-0000-0000-000000000002', N'MEDIA', N'10000000-0000-0000-0000-000000000001', N'30000000-0000-0000-0000-000000000005', NULL, CAST(N'2026-01-31T03:03:59.2019920' AS DateTime2), CAST(N'2026-02-15T03:03:59.2019920' AS DateTime2), NULL, NULL)
INSERT [dbo].[TAREA] ([ID], [TITULO], [DESCRIPCION], [ESTADO_ID], [PRIORIDAD], [UNIDAD_ID], [CREADO_POR], [ASIGNADO_A], [FECHA_CREACION], [ACTUALIZADO_EN], [ELIMINADO_EN], [ACTUALIZADO_POR]) VALUES (N'50000000-0000-0000-0000-000000000004', N'Revisión contratos vencidos', N'Identificar contratos laborales que vencen en marzo 2026', N'40000000-0000-0000-0000-000000000001', N'ALTA', N'10000000-0000-0000-0000-000000000001', N'30000000-0000-0000-0000-000000000006', NULL, CAST(N'2026-02-05T03:03:59.2019920' AS DateTime2), CAST(N'2026-02-15T03:03:59.2019920' AS DateTime2), NULL, NULL)
INSERT [dbo].[TAREA] ([ID], [TITULO], [DESCRIPCION], [ESTADO_ID], [PRIORIDAD], [UNIDAD_ID], [CREADO_POR], [ASIGNADO_A], [FECHA_CREACION], [ACTUALIZADO_EN], [ELIMINADO_EN], [ACTUALIZADO_POR]) VALUES (N'50000000-0000-0000-0000-000000000005', N'Encuesta clima laboral', N'Diseñar y enviar encuesta de clima laboral anual', N'40000000-0000-0000-0000-000000000002', N'MEDIA', N'10000000-0000-0000-0000-000000000001', N'30000000-0000-0000-0000-000000000002', NULL, CAST(N'2026-02-10T03:03:59.2019920' AS DateTime2), CAST(N'2026-02-15T03:03:59.2019920' AS DateTime2), NULL, NULL)
INSERT [dbo].[TAREA] ([ID], [TITULO], [DESCRIPCION], [ESTADO_ID], [PRIORIDAD], [UNIDAD_ID], [CREADO_POR], [ASIGNADO_A], [FECHA_CREACION], [ACTUALIZADO_EN], [ELIMINADO_EN], [ACTUALIZADO_POR]) VALUES (N'50000000-0000-0000-0000-000000000006', N'Cierre contable enero 2026', N'Realizar cierre contable del mes de enero', N'40000000-0000-0000-0000-000000000004', N'ALTA', N'10000000-0000-0000-0000-000000000002', N'30000000-0000-0000-0000-000000000003', NULL, CAST(N'2026-01-16T03:03:59.2019920' AS DateTime2), CAST(N'2026-02-15T03:03:59.2019920' AS DateTime2), NULL, NULL)
INSERT [dbo].[TAREA] ([ID], [TITULO], [DESCRIPCION], [ESTADO_ID], [PRIORIDAD], [UNIDAD_ID], [CREADO_POR], [ASIGNADO_A], [FECHA_CREACION], [ACTUALIZADO_EN], [ELIMINADO_EN], [ACTUALIZADO_POR]) VALUES (N'50000000-0000-0000-0000-000000000007', N'Presupuesto Q2 2026', N'Elaborar presupuesto del segundo trimestre con cada jefe de área', N'40000000-0000-0000-0000-000000000003', N'ALTA', N'10000000-0000-0000-0000-000000000002', N'30000000-0000-0000-0000-000000000003', NULL, CAST(N'2026-01-28T03:03:59.2019920' AS DateTime2), CAST(N'2026-02-15T03:03:59.2019920' AS DateTime2), NULL, NULL)
INSERT [dbo].[TAREA] ([ID], [TITULO], [DESCRIPCION], [ESTADO_ID], [PRIORIDAD], [UNIDAD_ID], [CREADO_POR], [ASIGNADO_A], [FECHA_CREACION], [ACTUALIZADO_EN], [ELIMINADO_EN], [ACTUALIZADO_POR]) VALUES (N'50000000-0000-0000-0000-000000000008', N'Conciliación bancaria febrero', N'Conciliar las cuentas bancarias del mes de febrero', N'40000000-0000-0000-0000-000000000001', N'MEDIA', N'10000000-0000-0000-0000-000000000002', N'30000000-0000-0000-0000-000000000007', NULL, CAST(N'2026-02-12T03:03:59.2019920' AS DateTime2), CAST(N'2026-02-15T03:03:59.2019920' AS DateTime2), NULL, NULL)
INSERT [dbo].[TAREA] ([ID], [TITULO], [DESCRIPCION], [ESTADO_ID], [PRIORIDAD], [UNIDAD_ID], [CREADO_POR], [ASIGNADO_A], [FECHA_CREACION], [ACTUALIZADO_EN], [ELIMINADO_EN], [ACTUALIZADO_POR]) VALUES (N'50000000-0000-0000-0000-000000000009', N'Auditoría gastos representación', N'Revisar gastos de representación del último semestre', N'40000000-0000-0000-0000-000000000002', N'BAJA', N'10000000-0000-0000-0000-000000000002', N'30000000-0000-0000-0000-000000000008', NULL, CAST(N'2026-02-03T03:03:59.2019920' AS DateTime2), CAST(N'2026-02-15T03:03:59.2019920' AS DateTime2), NULL, NULL)
INSERT [dbo].[TAREA] ([ID], [TITULO], [DESCRIPCION], [ESTADO_ID], [PRIORIDAD], [UNIDAD_ID], [CREADO_POR], [ASIGNADO_A], [FECHA_CREACION], [ACTUALIZADO_EN], [ELIMINADO_EN], [ACTUALIZADO_POR]) VALUES (N'50000000-0000-0000-0000-000000000010', N'Dashboard ventas Power BI', N'Crear dashboard interactivo de ventas mensuales en Power BI', N'40000000-0000-0000-0000-000000000003', N'ALTA', N'10000000-0000-0000-0000-000000000003', N'30000000-0000-0000-0000-000000000004', NULL, CAST(N'2026-01-24T03:03:59.2019920' AS DateTime2), CAST(N'2026-02-15T03:03:59.2019920' AS DateTime2), NULL, NULL)
INSERT [dbo].[TAREA] ([ID], [TITULO], [DESCRIPCION], [ESTADO_ID], [PRIORIDAD], [UNIDAD_ID], [CREADO_POR], [ASIGNADO_A], [FECHA_CREACION], [ACTUALIZADO_EN], [ELIMINADO_EN], [ACTUALIZADO_POR]) VALUES (N'50000000-0000-0000-0000-000000000011', N'ETL fuente datos SAP', N'Configurar pipeline ETL para extraer datos desde SAP', N'40000000-0000-0000-0000-000000000001', N'ALTA', N'10000000-0000-0000-0000-000000000003', N'30000000-0000-0000-0000-000000000009', NULL, CAST(N'2026-02-01T03:03:59.2019920' AS DateTime2), CAST(N'2026-02-15T03:03:59.2019920' AS DateTime2), NULL, NULL)
INSERT [dbo].[TAREA] ([ID], [TITULO], [DESCRIPCION], [ESTADO_ID], [PRIORIDAD], [UNIDAD_ID], [CREADO_POR], [ASIGNADO_A], [FECHA_CREACION], [ACTUALIZADO_EN], [ELIMINADO_EN], [ACTUALIZADO_POR]) VALUES (N'50000000-0000-0000-0000-000000000012', N'Informe KPIs mensual', N'Generar informe automático de KPIs para gerencia', N'40000000-0000-0000-0000-000000000004', N'MEDIA', N'10000000-0000-0000-0000-000000000003', N'30000000-0000-0000-0000-000000000004', NULL, CAST(N'2026-02-07T03:03:59.2019920' AS DateTime2), CAST(N'2026-02-15T03:03:59.2019920' AS DateTime2), NULL, NULL)
INSERT [dbo].[TAREA] ([ID], [TITULO], [DESCRIPCION], [ESTADO_ID], [PRIORIDAD], [UNIDAD_ID], [CREADO_POR], [ASIGNADO_A], [FECHA_CREACION], [ACTUALIZADO_EN], [ELIMINADO_EN], [ACTUALIZADO_POR]) VALUES (N'50000000-0000-0000-0000-000000000013', N'Migración servidor correo', N'Migrar servidor de correo a Exchange Online', N'40000000-0000-0000-0000-000000000003', N'ALTA', N'10000000-0000-0000-0000-000000000004', N'30000000-0000-0000-0000-000000000001', NULL, CAST(N'2026-01-18T03:03:59.2019920' AS DateTime2), CAST(N'2026-02-15T03:03:59.2019920' AS DateTime2), NULL, NULL)
INSERT [dbo].[TAREA] ([ID], [TITULO], [DESCRIPCION], [ESTADO_ID], [PRIORIDAD], [UNIDAD_ID], [CREADO_POR], [ASIGNADO_A], [FECHA_CREACION], [ACTUALIZADO_EN], [ELIMINADO_EN], [ACTUALIZADO_POR]) VALUES (N'50000000-0000-0000-0000-000000000014', N'Actualizar firewalls', N'Actualizar reglas de firewall en todos los segmentos de red', N'40000000-0000-0000-0000-000000000002', N'ALTA', N'10000000-0000-0000-0000-000000000004', N'30000000-0000-0000-0000-000000000010', NULL, CAST(N'2026-01-30T03:03:59.2019920' AS DateTime2), CAST(N'2026-02-15T03:03:59.2019920' AS DateTime2), NULL, NULL)
INSERT [dbo].[TAREA] ([ID], [TITULO], [DESCRIPCION], [ESTADO_ID], [PRIORIDAD], [UNIDAD_ID], [CREADO_POR], [ASIGNADO_A], [FECHA_CREACION], [ACTUALIZADO_EN], [ELIMINADO_EN], [ACTUALIZADO_POR]) VALUES (N'50000000-0000-0000-0000-000000000015', N'Inventario licencias software', N'Realizar inventario completo de licencias de software activas', N'40000000-0000-0000-0000-000000000001', N'BAJA', N'10000000-0000-0000-0000-000000000004', N'30000000-0000-0000-0000-000000000001', NULL, CAST(N'2026-02-13T03:03:59.2019920' AS DateTime2), CAST(N'2026-02-15T03:03:59.2019920' AS DateTime2), NULL, NULL)
GO
ALTER TABLE [dbo].[AUDITORIA_TAREAS] ADD  DEFAULT ('EXITOSO') FOR [RESULTADO]
GO
ALTER TABLE [dbo].[AUDITORIA_TAREAS] ADD  DEFAULT (sysutcdatetime()) FOR [CREADO_EN]
GO
ALTER TABLE [dbo].[ESTADO_TAREA] ADD  DEFAULT (newid()) FOR [ID]
GO
ALTER TABLE [dbo].[ESTADO_TAREA] ADD  DEFAULT ('#6B7280') FOR [COLOR]
GO
ALTER TABLE [dbo].[ESTADO_TAREA] ADD  DEFAULT ((0)) FOR [ORDEN]
GO
ALTER TABLE [dbo].[ESTADO_TAREA] ADD  DEFAULT ((0)) FOR [ES_DEFECTO]
GO
ALTER TABLE [dbo].[ESTADO_TAREA] ADD  DEFAULT ((1)) FOR [ESTA_ACTIVO]
GO
ALTER TABLE [dbo].[ESTADO_TAREA] ADD  DEFAULT (sysutcdatetime()) FOR [CREADO_EN]
GO
ALTER TABLE [dbo].[ESTADO_TAREA] ADD  DEFAULT (sysutcdatetime()) FOR [ACTUALIZADO_EN]
GO
ALTER TABLE [dbo].[HISTORIAL_TAREA] ADD  DEFAULT (sysutcdatetime()) FOR [CREADO_EN]
GO
ALTER TABLE [dbo].[SOLICITUD_APROBACION] ADD  DEFAULT (newid()) FOR [ID]
GO
ALTER TABLE [dbo].[SOLICITUD_APROBACION] ADD  DEFAULT ('MEDIA') FOR [PRIORIDAD]
GO
ALTER TABLE [dbo].[SOLICITUD_APROBACION] ADD  DEFAULT ('PENDIENTE') FOR [ESTADO_SOLICITUD]
GO
ALTER TABLE [dbo].[SOLICITUD_APROBACION] ADD  DEFAULT (sysutcdatetime()) FOR [CREADO_EN]
GO
ALTER TABLE [dbo].[TAREA] ADD  DEFAULT (newid()) FOR [ID]
GO
ALTER TABLE [dbo].[TAREA] ADD  DEFAULT ('MEDIA') FOR [PRIORIDAD]
GO
ALTER TABLE [dbo].[TAREA] ADD  DEFAULT (sysutcdatetime()) FOR [FECHA_CREACION]
GO
ALTER TABLE [dbo].[TAREA] ADD  DEFAULT (sysutcdatetime()) FOR [ACTUALIZADO_EN]
GO
ALTER TABLE [dbo].[HISTORIAL_TAREA]  WITH CHECK ADD  CONSTRAINT [FK_HISTORIAL_TAREA] FOREIGN KEY([TAREA_ID])
REFERENCES [dbo].[TAREA] ([ID])
GO
ALTER TABLE [dbo].[HISTORIAL_TAREA] CHECK CONSTRAINT [FK_HISTORIAL_TAREA]
GO
ALTER TABLE [dbo].[TAREA]  WITH CHECK ADD  CONSTRAINT [FK_TAREA_ESTADO] FOREIGN KEY([ESTADO_ID])
REFERENCES [dbo].[ESTADO_TAREA] ([ID])
GO
ALTER TABLE [dbo].[TAREA] CHECK CONSTRAINT [FK_TAREA_ESTADO]
GO
ALTER TABLE [dbo].[AUDITORIA_TAREAS]  WITH CHECK ADD  CONSTRAINT [CK_AUDITORIA_TAREAS_RESULTADO] CHECK  (([RESULTADO]='DENEGADO' OR [RESULTADO]='FALLIDO' OR [RESULTADO]='EXITOSO'))
GO
ALTER TABLE [dbo].[AUDITORIA_TAREAS] CHECK CONSTRAINT [CK_AUDITORIA_TAREAS_RESULTADO]
GO
ALTER TABLE [dbo].[SOLICITUD_APROBACION]  WITH CHECK ADD  CONSTRAINT [CK_SOLICITUD_ESTADO] CHECK  (([ESTADO_SOLICITUD]='RECHAZADA' OR [ESTADO_SOLICITUD]='APROBADA' OR [ESTADO_SOLICITUD]='PENDIENTE'))
GO
ALTER TABLE [dbo].[SOLICITUD_APROBACION] CHECK CONSTRAINT [CK_SOLICITUD_ESTADO]
GO
ALTER TABLE [dbo].[SOLICITUD_APROBACION]  WITH CHECK ADD  CONSTRAINT [CK_SOLICITUD_PRIORIDAD] CHECK  (([PRIORIDAD]='ALTA' OR [PRIORIDAD]='MEDIA' OR [PRIORIDAD]='BAJA'))
GO
ALTER TABLE [dbo].[SOLICITUD_APROBACION] CHECK CONSTRAINT [CK_SOLICITUD_PRIORIDAD]
GO
ALTER TABLE [dbo].[SOLICITUD_APROBACION]  WITH CHECK ADD  CONSTRAINT [CK_SOLICITUD_TIPO] CHECK  (([TIPO_ACCION]='ELIMINAR' OR [TIPO_ACCION]='COMPLETAR' OR [TIPO_ACCION]='EDITAR' OR [TIPO_ACCION]='CREAR'))
GO
ALTER TABLE [dbo].[SOLICITUD_APROBACION] CHECK CONSTRAINT [CK_SOLICITUD_TIPO]
GO
ALTER TABLE [dbo].[TAREA]  WITH CHECK ADD  CONSTRAINT [CK_TAREA_PRIORIDAD] CHECK  (([PRIORIDAD]='ALTA' OR [PRIORIDAD]='MEDIA' OR [PRIORIDAD]='BAJA'))
GO
ALTER TABLE [dbo].[TAREA] CHECK CONSTRAINT [CK_TAREA_PRIORIDAD]
GO
/****** Object:  StoredProcedure [dbo].[sp_APROBAR_SOLICITUD]    Script Date: 18/02/2026 15:11:55 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[sp_APROBAR_SOLICITUD] @SOLICITUD_ID UNIQUEIDENTIFIER, @APROBADO_POR UNIQUEIDENTIFIER
AS BEGIN
    SET NOCOUNT ON; BEGIN TRANSACTION;
    BEGIN TRY
        DECLARE @TIPO NVARCHAR(20), @TAREA_ID UNIQUEIDENTIFIER, @TITULO NVARCHAR(300), @DESCRIPCION NVARCHAR(MAX),
                @ESTADO_ID UNIQUEIDENTIFIER, @PRIORIDAD NVARCHAR(10), @UNIDAD_ID UNIQUEIDENTIFIER, @SOLICITANTE UNIQUEIDENTIFIER;
        SELECT @TIPO=TIPO_ACCION, @TAREA_ID=TAREA_ID, @TITULO=TITULO, @DESCRIPCION=DESCRIPCION,
               @ESTADO_ID=ESTADO_ID, @PRIORIDAD=PRIORIDAD, @UNIDAD_ID=UNIDAD_ID, @SOLICITANTE=SOLICITANTE_ID
        FROM SOLICITUD_APROBACION WHERE ID = @SOLICITUD_ID AND ESTADO_SOLICITUD = 'PENDIENTE';
        IF @TIPO IS NULL BEGIN RAISERROR('Solicitud no encontrada o ya procesada', 16, 1); RETURN; END
        IF @ESTADO_ID IS NULL SELECT @ESTADO_ID = ID FROM ESTADO_TAREA WHERE ES_DEFECTO = 1 AND ELIMINADO_EN IS NULL;

        IF @TIPO = 'CREAR' BEGIN
            DECLARE @NUEVA_TAREA UNIQUEIDENTIFIER = NEWID();
            INSERT INTO TAREA (ID,TITULO,DESCRIPCION,ESTADO_ID,PRIORIDAD,UNIDAD_ID,CREADO_POR) VALUES (@NUEVA_TAREA,@TITULO,@DESCRIPCION,@ESTADO_ID,@PRIORIDAD,@UNIDAD_ID,@SOLICITANTE);
            UPDATE SOLICITUD_APROBACION SET TAREA_ID = @NUEVA_TAREA WHERE ID = @SOLICITUD_ID; SET @TAREA_ID = @NUEVA_TAREA;
            INSERT INTO HISTORIAL_TAREA (TAREA_ID,ACCION,DATOS_NUEVOS,SOLICITUD_ID,REALIZADO_POR) VALUES (@NUEVA_TAREA,'CREADA',CONCAT('{"titulo":"',@TITULO,'","prioridad":"',@PRIORIDAD,'"}'),@SOLICITUD_ID,@APROBADO_POR);
        END
        IF @TIPO = 'EDITAR' BEGIN
            UPDATE TAREA SET TITULO=@TITULO, DESCRIPCION=@DESCRIPCION, ESTADO_ID=ISNULL(@ESTADO_ID,ESTADO_ID), PRIORIDAD=@PRIORIDAD, ACTUALIZADO_EN=SYSUTCDATETIME(), ACTUALIZADO_POR=@APROBADO_POR WHERE ID=@TAREA_ID AND ELIMINADO_EN IS NULL;
            INSERT INTO HISTORIAL_TAREA (TAREA_ID,ACCION,DATOS_NUEVOS,SOLICITUD_ID,REALIZADO_POR) VALUES (@TAREA_ID,'EDITADA',CONCAT('{"titulo":"',@TITULO,'"}'),@SOLICITUD_ID,@APROBADO_POR);
        END
        IF @TIPO = 'COMPLETAR' BEGIN
            DECLARE @ESTADO_COMP UNIQUEIDENTIFIER; SELECT @ESTADO_COMP = ID FROM ESTADO_TAREA WHERE NOMBRE = 'Completada' AND ELIMINADO_EN IS NULL;
            UPDATE TAREA SET ESTADO_ID=@ESTADO_COMP, ACTUALIZADO_EN=SYSUTCDATETIME(), ACTUALIZADO_POR=@APROBADO_POR WHERE ID=@TAREA_ID AND ELIMINADO_EN IS NULL;
            INSERT INTO HISTORIAL_TAREA (TAREA_ID,ACCION,SOLICITUD_ID,REALIZADO_POR) VALUES (@TAREA_ID,'COMPLETADA',@SOLICITUD_ID,@APROBADO_POR);
        END
        IF @TIPO = 'ELIMINAR' BEGIN
            UPDATE TAREA SET ELIMINADO_EN=SYSUTCDATETIME(), ACTUALIZADO_POR=@APROBADO_POR WHERE ID=@TAREA_ID AND ELIMINADO_EN IS NULL;
            INSERT INTO HISTORIAL_TAREA (TAREA_ID,ACCION,SOLICITUD_ID,REALIZADO_POR) VALUES (@TAREA_ID,'ELIMINADA',@SOLICITUD_ID,@APROBADO_POR);
        END
        UPDATE SOLICITUD_APROBACION SET ESTADO_SOLICITUD='APROBADA', APROBADO_POR=@APROBADO_POR, FECHA_RESOLUCION=SYSUTCDATETIME() WHERE ID=@SOLICITUD_ID;
        COMMIT TRANSACTION; SELECT 1 AS EXITO, 'Solicitud aprobada correctamente' AS MENSAJE, @TAREA_ID AS TAREA_ID;
    END TRY BEGIN CATCH ROLLBACK TRANSACTION; SELECT 0 AS EXITO, ERROR_MESSAGE() AS MENSAJE, NULL AS TAREA_ID; END CATCH
END

GO
/****** Object:  StoredProcedure [dbo].[sp_CONTADORES_APROBACIONES]    Script Date: 18/02/2026 15:11:55 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[sp_CONTADORES_APROBACIONES] @UNIDAD_ID UNIQUEIDENTIFIER = NULL
AS BEGIN SET NOCOUNT ON;
    SELECT SUM(CASE WHEN ESTADO_SOLICITUD='PENDIENTE' THEN 1 ELSE 0 END) AS TOTAL_PENDIENTES,
           SUM(CASE WHEN ESTADO_SOLICITUD='APROBADA' THEN 1 ELSE 0 END) AS TOTAL_APROBADAS,
           SUM(CASE WHEN ESTADO_SOLICITUD='RECHAZADA' THEN 1 ELSE 0 END) AS TOTAL_RECHAZADAS
    FROM SOLICITUD_APROBACION WHERE (@UNIDAD_ID IS NULL OR UNIDAD_ID = @UNIDAD_ID);
END

GO
/****** Object:  StoredProcedure [dbo].[sp_CONTADORES_REPORTES]    Script Date: 18/02/2026 15:11:55 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[sp_CONTADORES_REPORTES]
AS BEGIN SET NOCOUNT ON;
    SELECT (SELECT COUNT(*) FROM SOLICITUD_APROBACION WHERE ESTADO_SOLICITUD = 'APROBADA') AS REPORTES_APROBADOS,
           (SELECT COUNT(DISTINCT CREADO_POR) FROM TAREA WHERE ELIMINADO_EN IS NULL) AS REPORTES_PRODUCTIVIDAD,
           (SELECT COUNT(*) FROM TAREA WHERE PRIORIDAD = 'ALTA' AND ELIMINADO_EN IS NULL) AS REPORTES_CRITICIDAD,
           (SELECT COUNT(*) FROM HISTORIAL_TAREA) AS REPORTES_AUDITORIA;
END

GO
/****** Object:  StoredProcedure [dbo].[sp_RECHAZAR_SOLICITUD]    Script Date: 18/02/2026 15:11:55 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[sp_RECHAZAR_SOLICITUD] @SOLICITUD_ID UNIQUEIDENTIFIER, @RECHAZADO_POR UNIQUEIDENTIFIER, @MOTIVO NVARCHAR(500)
AS BEGIN SET NOCOUNT ON;
    UPDATE SOLICITUD_APROBACION SET ESTADO_SOLICITUD='RECHAZADA', APROBADO_POR=@RECHAZADO_POR, MOTIVO_RECHAZO=@MOTIVO, FECHA_RESOLUCION=SYSUTCDATETIME()
    WHERE ID = @SOLICITUD_ID AND ESTADO_SOLICITUD = 'PENDIENTE';
    IF @@ROWCOUNT = 0 SELECT 0 AS EXITO, 'Solicitud no encontrada o ya procesada' AS MENSAJE;
    ELSE SELECT 1 AS EXITO, 'Solicitud rechazada' AS MENSAJE;
END

GO
/****** Object:  StoredProcedure [dbo].[sp_REPORTE_AUDITORIA_SISTEMA]    Script Date: 18/02/2026 15:11:55 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[sp_REPORTE_AUDITORIA_SISTEMA]
    @FECHA_DESDE DATETIME2 = NULL, @FECHA_HASTA DATETIME2 = NULL, @UNIDAD_ID UNIQUEIDENTIFIER = NULL
AS BEGIN SET NOCOUNT ON;
    SELECT SA.TIPO_ACCION, SA.ESTADO_SOLICITUD, SA.UNIDAD_ID, COUNT(*) AS CANTIDAD, MIN(SA.CREADO_EN) AS PRIMERA_SOLICITUD, MAX(SA.CREADO_EN) AS ULTIMA_SOLICITUD
    FROM SOLICITUD_APROBACION SA WHERE (@FECHA_DESDE IS NULL OR SA.CREADO_EN >= @FECHA_DESDE) AND (@FECHA_HASTA IS NULL OR SA.CREADO_EN <= @FECHA_HASTA) AND (@UNIDAD_ID IS NULL OR SA.UNIDAD_ID = @UNIDAD_ID)
    GROUP BY SA.TIPO_ACCION, SA.ESTADO_SOLICITUD, SA.UNIDAD_ID ORDER BY SA.TIPO_ACCION, SA.ESTADO_SOLICITUD;
    SELECT HT.ID, HT.TAREA_ID, T.TITULO AS TAREA_TITULO, HT.ACCION, HT.REALIZADO_POR, T.UNIDAD_ID, HT.CREADO_EN
    FROM HISTORIAL_TAREA HT INNER JOIN TAREA T ON T.ID = HT.TAREA_ID
    WHERE (@FECHA_DESDE IS NULL OR HT.CREADO_EN >= @FECHA_DESDE) AND (@FECHA_HASTA IS NULL OR HT.CREADO_EN <= @FECHA_HASTA) AND (@UNIDAD_ID IS NULL OR T.UNIDAD_ID = @UNIDAD_ID)
    ORDER BY HT.CREADO_EN DESC;
END

GO
/****** Object:  StoredProcedure [dbo].[sp_REPORTE_PRIORIDAD_CRITICIDAD]    Script Date: 18/02/2026 15:11:55 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[sp_REPORTE_PRIORIDAD_CRITICIDAD] @UNIDAD_ID UNIQUEIDENTIFIER = NULL
AS BEGIN SET NOCOUNT ON;
    SELECT T.PRIORIDAD, ET.NOMBRE AS ESTADO, ET.COLOR AS ESTADO_COLOR, T.UNIDAD_ID, COUNT(*) AS CANTIDAD,
           MIN(T.FECHA_CREACION) AS TAREA_MAS_ANTIGUA, MAX(T.FECHA_CREACION) AS TAREA_MAS_RECIENTE,
           AVG(DATEDIFF(DAY, T.FECHA_CREACION, SYSUTCDATETIME())) AS PROMEDIO_DIAS_ABIERTA
    FROM TAREA T INNER JOIN ESTADO_TAREA ET ON ET.ID = T.ESTADO_ID
    WHERE T.ELIMINADO_EN IS NULL AND (@UNIDAD_ID IS NULL OR T.UNIDAD_ID = @UNIDAD_ID)
    GROUP BY T.PRIORIDAD, ET.NOMBRE, ET.COLOR, T.UNIDAD_ID
    ORDER BY CASE T.PRIORIDAD WHEN 'ALTA' THEN 1 WHEN 'MEDIA' THEN 2 WHEN 'BAJA' THEN 3 END, ET.NOMBRE;
    SELECT T.ID, T.TITULO, T.PRIORIDAD, ET.NOMBRE AS ESTADO, T.UNIDAD_ID, T.CREADO_POR, T.FECHA_CREACION,
           DATEDIFF(DAY, T.FECHA_CREACION, SYSUTCDATETIME()) AS DIAS_ABIERTA
    FROM TAREA T INNER JOIN ESTADO_TAREA ET ON ET.ID = T.ESTADO_ID
    WHERE T.ELIMINADO_EN IS NULL AND T.PRIORIDAD = 'ALTA' AND ET.NOMBRE != 'Completada' AND DATEDIFF(DAY, T.FECHA_CREACION, SYSUTCDATETIME()) > 7
      AND (@UNIDAD_ID IS NULL OR T.UNIDAD_ID = @UNIDAD_ID)
    ORDER BY DATEDIFF(DAY, T.FECHA_CREACION, SYSUTCDATETIME()) DESC;
END

GO
/****** Object:  StoredProcedure [dbo].[sp_REPORTE_PRODUCTIVIDAD_UNIDAD]    Script Date: 18/02/2026 15:11:55 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[sp_REPORTE_PRODUCTIVIDAD_UNIDAD]
    @FECHA_DESDE DATETIME2 = NULL, @FECHA_HASTA DATETIME2 = NULL
AS BEGIN SET NOCOUNT ON;
    SELECT T.UNIDAD_ID, COUNT(*) AS TOTAL_TAREAS,
           SUM(CASE WHEN ET.NOMBRE = 'Completada' THEN 1 ELSE 0 END) AS TAREAS_COMPLETADAS,
           SUM(CASE WHEN ET.NOMBRE = 'En Progreso' THEN 1 ELSE 0 END) AS TAREAS_EN_PROGRESO,
           SUM(CASE WHEN ET.NOMBRE IN ('Nueva','Pendiente') THEN 1 ELSE 0 END) AS TAREAS_PENDIENTES,
           CAST(CASE WHEN COUNT(*)>0 THEN (SUM(CASE WHEN ET.NOMBRE='Completada' THEN 1.0 ELSE 0 END)/COUNT(*))*100 ELSE 0 END AS DECIMAL(5,2)) AS PORCENTAJE_COMPLETADO
    FROM TAREA T INNER JOIN ESTADO_TAREA ET ON ET.ID = T.ESTADO_ID
    WHERE T.ELIMINADO_EN IS NULL AND (@FECHA_DESDE IS NULL OR T.FECHA_CREACION >= @FECHA_DESDE) AND (@FECHA_HASTA IS NULL OR T.FECHA_CREACION <= @FECHA_HASTA)
    GROUP BY T.UNIDAD_ID;
    SELECT T.CREADO_POR AS USUARIO_ID, T.UNIDAD_ID, COUNT(*) AS TOTAL_TAREAS,
           SUM(CASE WHEN ET.NOMBRE='Completada' THEN 1 ELSE 0 END) AS COMPLETADAS,
           SUM(CASE WHEN T.PRIORIDAD='ALTA' THEN 1 ELSE 0 END) AS TAREAS_ALTA_PRIORIDAD
    FROM TAREA T INNER JOIN ESTADO_TAREA ET ON ET.ID = T.ESTADO_ID
    WHERE T.ELIMINADO_EN IS NULL AND (@FECHA_DESDE IS NULL OR T.FECHA_CREACION >= @FECHA_DESDE) AND (@FECHA_HASTA IS NULL OR T.FECHA_CREACION <= @FECHA_HASTA)
    GROUP BY T.CREADO_POR, T.UNIDAD_ID ORDER BY COMPLETADAS DESC;
END

GO
/****** Object:  StoredProcedure [dbo].[sp_REPORTE_SOLICITUDES_APROBADAS]    Script Date: 18/02/2026 15:11:55 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[sp_REPORTE_SOLICITUDES_APROBADAS]
    @FECHA_DESDE DATETIME2 = NULL, @FECHA_HASTA DATETIME2 = NULL, @UNIDAD_ID UNIQUEIDENTIFIER = NULL
AS BEGIN SET NOCOUNT ON;
    SELECT SA.ID AS SOLICITUD_ID, SA.TIPO_ACCION, SA.TITULO AS TAREA_TITULO, SA.DESCRIPCION AS TAREA_DESCRIPCION,
           SA.PRIORIDAD, SA.UNIDAD_ID, SA.SOLICITANTE_ID, SA.APROBADO_POR, SA.CREADO_EN AS FECHA_SOLICITUD,
           SA.FECHA_RESOLUCION AS FECHA_APROBACION, DATEDIFF(HOUR, SA.CREADO_EN, SA.FECHA_RESOLUCION) AS HORAS_RESOLUCION,
           T.ID AS TAREA_ID, ET.NOMBRE AS ESTADO_ACTUAL
    FROM SOLICITUD_APROBACION SA LEFT JOIN TAREA T ON T.ID = SA.TAREA_ID LEFT JOIN ESTADO_TAREA ET ON ET.ID = T.ESTADO_ID
    WHERE SA.ESTADO_SOLICITUD = 'APROBADA'
      AND (@FECHA_DESDE IS NULL OR SA.FECHA_RESOLUCION >= @FECHA_DESDE)
      AND (@FECHA_HASTA IS NULL OR SA.FECHA_RESOLUCION <= @FECHA_HASTA)
      AND (@UNIDAD_ID IS NULL OR SA.UNIDAD_ID = @UNIDAD_ID)
    ORDER BY SA.FECHA_RESOLUCION DESC;
END

GO
/****** Object:  StoredProcedure [dbo].[sp_REPORTE_SOLICITUDES_RECHAZADAS]    Script Date: 18/02/2026 15:11:55 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[sp_REPORTE_SOLICITUDES_RECHAZADAS]
    @FECHA_DESDE DATETIME2 = NULL, @FECHA_HASTA DATETIME2 = NULL, @UNIDAD_ID UNIQUEIDENTIFIER = NULL
AS BEGIN SET NOCOUNT ON;
    SELECT SA.ID AS SOLICITUD_ID, SA.TIPO_ACCION, SA.TITULO AS TAREA_TITULO, SA.PRIORIDAD, SA.UNIDAD_ID,
           SA.SOLICITANTE_ID, SA.APROBADO_POR AS RECHAZADO_POR, SA.MOTIVO_RECHAZO,
           SA.CREADO_EN AS FECHA_SOLICITUD, SA.FECHA_RESOLUCION AS FECHA_RECHAZO,
           DATEDIFF(HOUR, SA.CREADO_EN, SA.FECHA_RESOLUCION) AS HORAS_RESOLUCION
    FROM SOLICITUD_APROBACION SA WHERE SA.ESTADO_SOLICITUD = 'RECHAZADA'
      AND (@FECHA_DESDE IS NULL OR SA.FECHA_RESOLUCION >= @FECHA_DESDE) AND (@FECHA_HASTA IS NULL OR SA.FECHA_RESOLUCION <= @FECHA_HASTA)
      AND (@UNIDAD_ID IS NULL OR SA.UNIDAD_ID = @UNIDAD_ID)
    ORDER BY SA.FECHA_RESOLUCION DESC;
END

GO
